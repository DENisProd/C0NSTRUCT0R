# Документация проекта C0NSTRUCT0R

## Содержание

1. [Обзор проекта](#обзор-проекта)
2. [Архитектура системы](#архитектура-системы)
3. [Компоненты системы](#компоненты-системы)
4. [Взаимодействие компонентов](#взаимодействие-компонентов)
5. [Функциональность](#функциональность)
6. [Инфраструктура](#инфраструктура)
7. [Безопасность](#безопасность)
8. [Мониторинг и метрики](#мониторинг-и-метрики)
9. [Развертывание](#развертывание)
10. [Масштабирование](#масштабирование)

---

## Обзор проекта

**C0NSTRUCT0R** — это платформа для создания лендингов с визуальным редактором, поддержкой совместной работы в реальном времени и генерацией контента с помощью искусственного интеллекта.

### Основные возможности

- **Визуальный редактор** — создание лендингов через drag & drop интерфейс
- **Совместная работа** — редактирование проектов несколькими пользователями одновременно
- **AI-генерация** — автоматическое создание лендингов по текстовому описанию
- **Библиотека блоков** — готовые компоненты для быстрого создания страниц
- **Адаптивный дизайн** — автоматическая адаптация под разные устройства
- **Экспорт/Импорт** — сохранение и загрузка проектов в формате JSON

### Целевая аудитория

- Дизайнеры и разработчики, создающие лендинги
- Маркетологи, нуждающиеся в быстром создании страниц
- Команды, работающие над проектами совместно
- Пользователи без технических знаний, желающие создать сайт

---

## Архитектура системы

### Общая архитектура

Проект построен по микросервисной архитектуре с разделением на три основных компонента:

```
┌─────────────────────────────────────────────────────────┐
│                    Frontend (React)                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │   Editor     │  │   Library    │  │   Profile    │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
                        │              │
                        │ HTTP         │ WebSocket
                        ▼              ▼
┌─────────────────────────────────────────────────────────┐
│              Backend (FastAPI)                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │   REST API   │  │  WebSocket   │  │   Auth       │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
        │              │              │
        ▼              ▼              ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│  PostgreSQL  │  │    MinIO     │  │  ML Service  │
│   Database   │  │   Storage    │  │   (Ollama)    │
└──────────────┘  └──────────────┘  └──────────────┘
```

### Принципы архитектуры

1. **Разделение ответственности** — каждый компонент решает свою задачу
2. **Асинхронность** — использование WebSocket для реального времени
3. **Масштабируемость** — возможность горизонтального масштабирования
4. **Независимость** — компоненты могут работать отдельно
5. **API-first** — все взаимодействие через четко определенные API

---

## Компоненты системы

### 1. Frontend (React + TypeScript)

**Технологии:**
- React 18 с TypeScript
- Vite для сборки
- Zustand для управления состоянием
- Chakra UI для компонентов интерфейса
- @dnd-kit для drag & drop
- WebSocket для реального времени

**Основные модули:**

#### Редактор
Визуальный редактор для создания и редактирования лендингов. Состоит из:
- **Workspace** — рабочая область с блоками
- **BlocksPanel** — панель доступных блоков
- **PropertiesPanel** — панель редактирования свойств
- **Toolbar** — верхняя панель инструментов

#### Библиотека блоков
Управление готовыми блоками и шаблонами:
- Просмотр системных блоков
- Просмотр блоков сообщества
- Управление пользовательскими блоками
- Поиск и фильтрация

#### Профиль пользователя
Управление аккаунтом:
- Редактирование профиля
- Управление проектами
- Управление блоками
- Загрузка аватара

#### Генерация лендингов
Интерфейс для AI-генерации:
- Ввод описания лендинга
- Выбор категорий блоков
- Предпросмотр результата
- Применение к проекту

### 2. Backend (FastAPI)

**Технологии:**
- FastAPI для REST API
- WebSocket для реального времени
- SQLAlchemy для работы с БД
- Alembic для миграций
- JWT для аутентификации
- MinIO клиент для работы с хранилищем

**Основные модули:**

#### API v1
RESTful API для всех операций:
- **Auth** — регистрация, вход, смена пароля
- **User** — управление профилем, аватары
- **Projects** — CRUD операции с проектами
- **User Blocks** — управление пользовательскими блоками
- **Library** — библиотека блоков (системные, сообщество, пользовательские)
- **AI** — генерация лендингов
- **Palette** — работа с цветовыми палитрами
- **Media** — загрузка и управление медиафайлами

#### WebSocket сервер
Сервер для совместной работы:
- Подключение к комнатам проектов
- Синхронизация изменений в реальном времени
- Отслеживание курсоров пользователей
- Управление состоянием комнат

#### Сервисы
Бизнес-логика приложения:
- **Auth Service** — аутентификация и авторизация
- **LLM Generator** — интеграция с ML-сервисом
- **Block Render** — подготовка блоков для рендеринга
- **Palette Generator** — генерация цветовых палитр
- **MinIO Service** — работа с объектным хранилищем

### 3. ML Service (FastAPI + Ollama)

**Технологии:**
- FastAPI для API
- Ollama для локальной LLM
- Pydantic для валидации
- Prometheus для метрик

**Функциональность:**

#### Генерация лендингов
Преобразование текстового описания в JSON-структуру лендинга:
- Анализ запроса пользователя
- Генерация структуры блоков
- Создание цветовой палитры
- Формирование метаданных

#### Валидация
Проверка корректности сгенерированных данных:
- Соответствие схеме
- Корректность типов блоков
- Валидность цветовых значений

### 4. База данных (PostgreSQL)

**Схема данных:**

#### Пользователи
- Учетные записи пользователей
- Профили с аватарами
- Статистика по проектам и блокам

#### Проекты
- Метаданные проектов
- JSON-данные лендингов
- Связь с пользователями
- Soft delete для восстановления

#### Блоки
- Системные блоки
- Блоки сообщества
- Пользовательские блоки
- Категории и теги

#### Медиа
- Метаданные загруженных файлов
- Связь с проектами
- Интеграция с MinIO

#### Палитры
- Предустановленные палитры
- Пользовательские палитры
- Связь с проектами

### 5. Хранилище (MinIO)

**Использование:**
- Хранение изображений проектов
- Хранение аватаров пользователей
- Хранение превью блоков
- Резервное копирование

**Организация:**
- Buckets для разных типов данных
- Service Account для доступа
- ETag для оптимизации кеширования

### 6. Мониторинг

#### Prometheus
Сбор метрик:
- Производительность API
- Использование ресурсов
- Ошибки и исключения
- Время ответа

#### Grafana
Визуализация метрик:
- Дашборды для backend
- Дашборды для ML-сервиса
- Алерты и уведомления

---

## Взаимодействие компонентов

### Сценарий 1: Создание проекта

1. **Пользователь** открывает редактор во frontend
2. **Frontend** загружает список проектов через REST API
3. **Backend** возвращает проекты из PostgreSQL
4. **Пользователь** создает новый проект
5. **Frontend** отправляет запрос на создание
6. **Backend** сохраняет проект в БД
7. **Frontend** открывает WebSocket соединение для синхронизации

### Сценарий 2: Совместное редактирование

1. **Пользователь A** подключается к комнате проекта через WebSocket
2. **Backend** добавляет пользователя в комнату и отправляет текущее состояние
3. **Пользователь A** вносит изменения (добавляет блок)
4. **Frontend** отправляет сообщение через WebSocket
5. **Backend** обновляет состояние комнаты и рассылает всем участникам
6. **Пользователь B** получает обновление и видит изменения
7. **Backend** периодически сохраняет состояние в БД

### Сценарий 3: Генерация лендинга

1. **Пользователь** вводит описание лендинга
2. **Frontend** отправляет запрос в ML Service
3. **ML Service** обрабатывает запрос через Ollama
4. **Ollama** генерирует JSON-структуру лендинга
5. **ML Service** валидирует и возвращает результат
6. **Frontend** применяет результат к проекту
7. **Backend** сохраняет проект в БД

### Сценарий 4: Загрузка изображения

1. **Пользователь** выбирает изображение для загрузки
2. **Frontend** отправляет файл в Backend
3. **Backend** загружает файл в MinIO
4. **MinIO** сохраняет файл и возвращает метаданные
5. **Backend** сохраняет метаданные в PostgreSQL
6. **Backend** возвращает URL изображения
7. **Frontend** отображает изображение в редакторе

### Сценарий 5: Аутентификация

1. **Пользователь** вводит логин и пароль
2. **Frontend** отправляет запрос на вход
3. **Backend** проверяет учетные данные в БД
4. **Backend** генерирует JWT токен
5. **Backend** возвращает токен frontend
6. **Frontend** сохраняет токен и использует для последующих запросов
7. **Backend** проверяет токен при каждом запросе

---

## Функциональность

### Редактор лендингов

#### Базовые блоки
- **Текст** — редактируемый текстовый контент
- **Изображение** — загрузка и отображение изображений
- **Кнопка** — кнопки с ссылками и действиями
- **Видео** — встраивание видео
- **Текстовое поле** — поля ввода для форм

#### Составные блоки
- **Контейнер** — flexbox-контейнер для группировки блоков
- **Сетка** — CSS Grid для сложных макетов

#### Редактирование
- Drag & Drop для перемещения блоков
- Inline-редактирование текста
- Панель свойств для настройки стилей
- Адаптивные стили для разных устройств
- Применение цветовых палитр

#### Функции и логика
- Визуальное программирование
- Привязка функций к событиям блоков
- Условия выполнения действий
- Пользовательский код

### Библиотека блоков

#### Типы блоков
- **Системные** — встроенные блоки платформы
- **Сообщества** — блоки от других пользователей
- **Пользовательские** — собственные блоки пользователя

#### Управление
- Создание и сохранение блоков
- Категоризация и тегирование
- Поиск и фильтрация
- Превью блоков

### AI-генерация

#### Генерация лендингов
- Текстовое описание → структура лендинга
- Автоматический подбор блоков
- Генерация цветовых палитр
- Создание метаданных

#### Настройки
- Выбор категорий блоков
- Язык генерации
- Тема оформления

### Совместная работа

#### Реальное время
- Синхронизация изменений
- Отслеживание курсоров
- Список участников
- Уведомления о подключениях

#### Управление комнатами
- Создание комнат для проектов
- Подключение по ID проекта
- Автоматическое сохранение состояния

### Управление проектами

#### Операции
- Создание проектов
- Редактирование проектов
- Удаление проектов (soft delete)
- Экспорт/Импорт в JSON

#### Медиа
- Загрузка изображений
- Управление медиафайлами
- Связь с проектами

### Профиль пользователя

#### Управление аккаунтом
- Редактирование профиля
- Загрузка аватара
- Смена пароля
- Статистика по проектам и блокам

---

## Инфраструктура

### Контейнеризация

Проект использует Docker для контейнеризации всех компонентов:

#### Frontend
- Сборка через Vite
- Статические файлы в Nginx
- Оптимизация для production

#### Backend
- Python 3.9+ окружение
- Автоматические миграции при старте
- Health checks для мониторинга

#### ML Service
- Изолированное окружение
- Интеграция с Ollama
- Метрики Prometheus

#### База данных
- PostgreSQL 16
- Health checks
- Персистентное хранилище

#### MinIO
- Объектное хранилище
- Консоль управления
- Автоматическая инициализация

### Сети

#### Внутренняя сеть
- Изолированная Docker сеть
- Взаимодействие по именам сервисов
- Защита от внешнего доступа

#### Внешний доступ
- Nginx как reverse proxy
- Проксирование API запросов
- WebSocket поддержка

### Хранилище

#### Volumes
- PostgreSQL данные
- MinIO данные
- Prometheus метрики
- Frontend build

#### Персистентность
- Данные сохраняются между перезапусками
- Резервное копирование через volumes

---

## Безопасность

### Аутентификация

#### JWT токены
- Срок жизни 30 дней
- Хранение в localStorage
- Автоматическое обновление

#### Пароли
- Хеширование через bcrypt
- Минимальные требования к сложности
- Защита от брутфорса

### Авторизация

#### Защита эндпоинтов
- Проверка токена на каждом запросе
- Разделение прав доступа
- Защита от неавторизованного доступа

#### WebSocket
- Опциональная аутентификация через токен
- Идентификация пользователей
- Защита от несанкционированного доступа

### Данные

#### Валидация
- Проверка всех входящих данных
- Защита от SQL-инъекций через ORM
- Защита от XSS через санитизацию

#### Хранение
- Шифрование паролей
- Безопасное хранение токенов
- Защита медиафайлов

### CORS

#### Настройка
- Разрешенные домены
- Защита от CSRF
- Настройка для production

---

## Мониторинг и метрики

### Prometheus

#### Метрики Backend
- Количество запросов
- Время ответа
- Ошибки и исключения
- Использование ресурсов

#### Метрики ML Service
- Время генерации
- Количество запросов
- Использование модели
- Ошибки валидации

### Grafana

#### Дашборды
- Обзор backend
- Производительность API
- Метрики ML-сервиса
- Использование ресурсов

#### Алерты
- Высокое время ответа
- Большое количество ошибок
- Проблемы с подключением к БД

### Логирование

#### Уровни логов
- INFO — общая информация
- WARNING — предупреждения
- ERROR — ошибки
- DEBUG — отладочная информация

#### Хранение
- Логи в stdout/stderr
- Интеграция с Docker logs
- Возможность перенаправления

---

## Развертывание

### Тестовый режим

Минимальная конфигурация для разработки:
- Frontend + Backend
- PostgreSQL
- Без ML Service
- Без мониторинга

**Использование:**
- Локальная разработка
- Тестирование функциональности
- Быстрый старт

### Полный режим

Полная конфигурация со всеми сервисами:
- Frontend + Backend
- ML Service + Ollama
- PostgreSQL
- MinIO
- Prometheus + Grafana

**Использование:**
- Production окружение
- Полное тестирование
- Мониторинг и метрики

### Переменные окружения

#### Backend
- Настройки базы данных
- JWT секреты
- MinIO конфигурация
- CORS настройки

#### ML Service
- Адрес Ollama
- Модель для использования
- CORS настройки
- Mock режим для тестов

#### Frontend
- URL backend API
- URL ML Service
- URL WebSocket сервера

### Миграции

#### Автоматические
- Применяются при старте backend
- Проверка актуальности схемы
- Откат при ошибках

#### Ручные
- Создание новых миграций
- Применение миграций
- Откат миграций

---

## Масштабирование

### Горизонтальное масштабирование

#### Frontend
- Статические файлы в CDN
- Кеширование через Nginx
- Load balancing

#### Backend
- Несколько инстансов
- Shared state через БД
- WebSocket через sticky sessions

#### ML Service
- Несколько инстансов
- Load balancing
- Кеширование результатов

### Вертикальное масштабирование

#### Ресурсы
- Увеличение CPU/RAM
- Оптимизация запросов
- Индексы в БД

#### Оптимизация
- Кеширование запросов
- Оптимизация запросов к БД
- Сжатие ответов

### База данных

#### Репликация
- Master-Slave репликация
- Чтение с реплик
- Запись на master

#### Шардирование
- Разделение по проектам
- Разделение по пользователям
- Горизонтальное разделение

### Хранилище

#### MinIO
- Кластерная конфигурация
- Репликация данных
- Распределенное хранение

---

## Дополнительные возможности

### Экспорт/Импорт

#### Формат JSON
- Полная структура проекта
- Все блоки и стили
- Функции и логика
- Тема оформления

#### Использование
- Резервное копирование
- Перенос между проектами
- Версионирование
- Шаблоны

### Шаблоны

#### Типы шаблонов
- Системные шаблоны
- Шаблоны сообщества
- Пользовательские шаблоны

#### Применение
- Быстрое создание проектов
- Стандартные макеты
- Переиспользование блоков

### Адаптивность

#### Брейкпоинты
- Desktop (по умолчанию)
- Tablet
- Mobile

#### Автоматическая адаптация
- Изменение стилей
- Перестройка макетов
- Оптимизация контента

### Цветовые палитры

#### Генерация
- AI-генерация по описанию
- Предустановленные палитры
- Пользовательские палитры

#### Применение
- Автоматическое применение к блокам
- Сохранение палитр
- Экспорт палитр

---

## Заключение

C0NSTRUCT0R — это комплексная платформа для создания лендингов с современной архитектурой, поддержкой совместной работы и интеграцией искусственного интеллекта. Система спроектирована для масштабирования, надежности и удобства использования.

### Ключевые преимущества

- **Гибкость** — поддержка различных типов блоков и макетов
- **Скорость** — быстрая генерация через AI
- **Совместная работа** — редактирование в реальном времени
- **Масштабируемость** — возможность горизонтального масштабирования
- **Надежность** — мониторинг и метрики для контроля состояния

### Дальнейшее развитие

- Расширение библиотеки блоков
- Улучшение AI-генерации
- Дополнительные интеграции
- Оптимизация производительности
- Расширение функциональности редактора
- Авторазвертывание SEO-оптимизированного сайта на NextJS в Kubernetes и выделение поддомена для пользователя

