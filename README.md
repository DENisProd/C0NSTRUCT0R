# C0NSTRUCT0R — локальный ИИ-конструктор лендингов с совместным редактированием

## Краткое описание проекта

C0NSTRUCT0R — платформа для создания лендингов: визуальный drag-and-drop редактор, бэкенд с WebSocket-совместным редактированием и ML-сервис, который по текстовому описанию генерирует структуру лендинга в JSON и передает на во frontend для отрисовки.

Основные идеи:

- все крутится в Docker, без доступа во внешние сети;
- верстка собирается из блоков (текст, картинки, видео, формы, контейнеры, сетки);
- есть библиотека готовых блоков и возможность сохранять свои;
- есть визуальная система событий и функций (логика на уровне «при клике — прокрутить/показать/скрыть/переключить»);
- ML-сервис генерирует черновик лендинга и палитру по короткому описанию, позволяет вносить в него изменения;
- поддерживается совместное редактирование в реальном времени через WebSocket: курсоры, выделенные блоки и изменения видят все участники.

Технологический стек:

- **Frontend**: React + TypeScript + Vite, Chakra UI, `@dnd-kit` для drag-and-drop.
- **Backend**: FastAPI (REST + WebSocket), PostgreSQL, MinIO.
- **ML-service**: FastAPI + Gemini (API), Prometheus + Grafana для метрик.

---

## Состав

- **frontend** — Vite/React из архива (`app/constructor-frontend/constructor-frontend`), сборка → Nginx.
- **backend** — FastAPI WebSocket-сервер из архива (`app/constructor-backend/constructor-backend`).
- **ml-service** — сервис генерации JSON-шаблонов (FastAPI + Gemini), метрики Prometheus, дашборд Grafana.

## Запуск

### 1) Тестовый режим: только фронт и бэк

```bash
cd ./  # корень этого стека
docker compose -f docker-compose.test.yml up -d --build
# Фронт:  http://localhost:8080
# Бэк WS: ws://localhost:8000
```

Во фронте в форме подключения укажите `ws://localhost:8000` или оставьте по умолчанию.

### 2) Полный режим: фронт + бэк + ml-service + gemini + Prometheus + Grafana

```bash
cd ./
cp ml-service/.env.example ml-service/.env
docker compose -f docker-compose.full.yml up -d --build
# Поднимутся:
# - frontend (Nginx + статический React)
# - backend (FastAPI + WebSocket)
# - ml-service (FastAPI + Ollama client + Prometheus)
# - prometheus
# - grafana

# Доступы:
# Фронт:     http://localhost:8080
# Бэк WS:    ws://localhost:8000
# Бэк Swager http://localhost:8000/docs#
# Prometheus http://localhost:9090
# Grafana:   http://localhost:3000  (admin/admin -> Dashboards -> Constructor -> Backend Overview)
```

## Переменные

- `backend/.env` — содержит GEMINI_API_KEY для запросов к модели, 
- При тестировании нужно заполнить данные переменную

---

## Подробная работа с конструктором

Практическое описание конструктора: интерфейс, типы блоков, сценарии работы и возможности.

### 1. Общий сценарий использования

1. Пользователь регистрируется / входит в систему.
2. Создает новый проект лендинга или открывает существующий.
3. Дальше есть три варианта:
   - собирает лендинг полностью руками из базовых блоков;
   - генерирует черновик лендинга через ИИ и дорабатывает его;
   - комбинирует готовые блоки/шаблоны из библиотеки с ручной доработкой.

Результат — JSON-структура проекта (`projectName`, `header`, `blocks`, `footer`, `theme`), которую можно:

- редактировать в визуальном редакторе;
- экспортировать в JSON;
- импортировать обратно;
- использовать на стороне любой витрины/сайта.

---

### 2. Интерфейс редактора

Редактор организован в виде трёх основных зон:

1. **Верхняя панель (Toolbar)**:
   - название текущего проекта;
   - индикатор подключения к WebSocket (совместное редактирование);
   - выбор брейкпоинта (desktop / tablet / mobile);
   - кнопка запуска ИИ-генерации («волшебная палочка») — переход на страницу генерации;
   - кнопка предпросмотра (Full-page preview);
   - меню «Ещё»: экспорт/импорт JSON, переход в профиль и т.п.;
   - переключение темы интерфейса (светлая/тёмная).

2. **Левая панель (BlocksPanel)** — четыре вкладки:
   - **Blocks** — базовые блоки, контейнеры и сетки для сборки лендинга;
   - **Library** — библиотека готовых сложных блоков/секций;
   - **Theme** — выбор и применение цветовых палитр к проекту;
   - **Logic** — функции и события (визуальная логика).

3. **Центральное поле (Workspace)**:
   - здесь показывается сам лендинг: шапка, тело, подвал;
   - блоки располагаются вертикальным списком;
   - поддерживается drag-and-drop для добавления, перестановки и вложенности;
   - зоны DropZone подсвечиваются при перетаскивании блока.

4. **Правая панель (PropertiesPanel)**:
   - свойства выбранного блока: текст, ссылки, стили, отступы, выравнивание;
   - работа с адаптивными стилями по брейкпоинтам;
   - загрузка изображений для ImageBlock через `ImageUploader`;
   - привязка событий/функций к блоку (логика).

Дополнительно:

- **Header/Footer редакторы** — отдельные секции для настройки шапки и подвала проекта (логотип, название компании, фон и цвет текста).
- **CursorsOverlay + usePresence** — поверх рабочей области отображаются курсоры и выделения других пользователей в реальном времени.

---

### 3. Типы блоков

#### 3.1. Базовые блоки

Это простые блоки, которые не содержат внутри других блоков.

1. **TextBlock (Текст)**  
   Используется для заголовков, подзаголовков, описаний.

   Основные свойства:
   - `content` — сам текст;
   - `style` — шрифт, размер, цвет, выравнивание, отступы, жирность.

   Что можно делать:
   - редактировать текст прямо в рабочем поле (inline-редактирование);
   - менять размер шрифта, цвет и выравнивание в правой панели;
   - настраивать отступы, ширину, фон, скругление углов;
   - подключать события (например, при клике).

2. **ImageBlock (Изображение)**  
   Для картинок, иллюстраций, логотипов.

   Основные свойства:
   - `mediaEtag` / `url` — ссылка на загруженное в MinIO изображение;
   - `style` — размеры, выравнивание, фон, скругление.

   Что можно делать:
   - загружать изображение через встроенный `ImageUploader`;
   - выбирать уже загруженные медиа из проекта;
   - управлять шириной/высотой, размещением (центр/слева/справа);
   - применять скругление, фон, отступы.

3. **ButtonBlock (Кнопка)**  
   Ключевой элемент для CTA (формы, заявки).

   Основные свойства:
   - `text` — надпись на кнопке;
   - `link` — ссылка или якорь (например, `#form`);
   - `variant` — тип кнопки (`solid`, `radio`, `checkbox`);
   - `buttonColor` и стиль (цвет, фон, радиус, отступы).

   Что можно делать:
   - задавать внешний вид кнопки (цвет, размер, закругление);
   - привязывать события `onClick`:
     - переход по ссылке;
     - прокрутка к блоку;
     - показ/скрытие элементов;
     - запуск пользовательских функций.

4. **VideoBlock (Видео)**  
   Для встраивания видео (например, промо-роликов).

   Основные свойства:
   - `url` — ссылка на видео (YouTube/другие источники);
   - `style` — размеры и расположение.

   Что можно делать:
   - встраивать промо-видео на лендинг;
   - управлять шириной и пропорциями;
   - включать видео в сетку/контейнер.

5. **InputBlock (Поле ввода)**  
   Основной элемент для форм заявки/обратной связи.

   Основные свойства:
   - `value` — значение (по необходимости);
   - `placeholder` — подсказка;
   - `name` — имя поля (для последующей обработки);
   - `style` — ширина, отступы, фон, границы.

   Что можно делать:
   - собирать формы (имя, телефон, email, сообщение);
   - комбинировать с кнопками в одном контейнере/секции;
   - использовать события `onFocus`, `onBlur`, `onChange` в системе логики.

#### 3.2. Составные блоки

Эти блоки могут содержать внутри другие блоки и задают структуру/layout.

1. **ContainerBlock (Контейнер)**  
   Используется для группировки блоков и построения секций.

   Основные свойства:
   - `children: Block[]` — массив вложенных блоков;
   - `style` — `display: 'flex'`, направление (`flexDirection`), выравнивание, отступы, фон.

   Типичные сценарии:
   - обертка для блока «герой» (заголовок + текст + кнопка + картинка);
   - горизонтальное расположение элементов (две колонки: текст + фото);
   - центрирование содержимого по вертикали/горизонтали.

2. **GridBlock (Сетка)**  
   Блок для сложных сеточных макетов (CSS Grid).

   Основные свойства:
   - `settings`:
     - `columns`, `rows` — количество колонок и строк;
     - `gapX`, `gapY` — отступы между ячейками;
     - `align`, `justify` — выравнивание;
     - `placementType` — режим размещения (auto/fixed/fraction);
   - `cells: GridCell[]` — содержимое ячеек.

   Что можно делать:
   - создавать сетки преимуществ, тарифов, карточек;
   - управлять количеством колонок (например, 3 на desktop, 1 на mobile);
   - наполнять каждую ячейку любыми блоками (текст, кнопки, изображения).

---

### 4. Операции с блоками в редакторе

1. **Добавление блока**:
   - выбрать вкладку **Blocks** или **Library** в левой панели;
   - перетащить нужный элемент в рабочую область (на DropZone);
   - при наведении видны подсказки, куда блок будет вставлен.

2. **Перемещение и вложенность**:
   - блоки можно перетаскивать вверх/вниз по списку;
   - контейнеры и сетки позволяют вкладывать блоки внутрь себя;
   - перестановка работает даже для вложенных структур.

3. **Редактирование содержимого**:
   - текст — редактируется прямо в блоке;
   - свойства (цвет, фон, отступы, ширина) — через правую панель;
   - для изображений — отдельная зона загрузки/выбора медиа.

4. **Адаптивность**:
   - в Toolbar выбирается брейкпоинт: desktop / tablet / mobile;
   - для каждого брейкпоинта можно задать свои размеры, отступы и выравнивание;
   - редактор показывает, какие стили отличаются от «десктопных».

5. **Удаление и копирование**:
   - в панели свойств есть действия по удалению блока;
   - сложные комбинации блоков удобно сохранять в библиотеку как шаблон (см. раздел «Библиотека блоков»).

---

### 5. Темы и палитры

Каждый проект имеет объект `theme`:

```ts
interface Theme {
  mode: 'light' | 'dark';
  accent: string;
  text: string;
  heading: string;
  background: string;
  surface: string;
  border: string;
}
```

Возможности:

- выбор цветовой палитры в вкладке **Theme** левой панели;
- применение палитры ко всему проекту одной кнопкой;
- переключение между светлой и темной темой;
- автоматическое применение палитры, сгенерированной ML-сервисом, к текущему проекту.

Эта схема позволяет быстро привести весь лендинг к единому визуальному стилю.

---

### 6. Библиотека блоков и шаблонов

Библиотека — один из ключевых элементов конструктора.

Типы блоков в библиотеке:

- **Системные** — базовые готовые секции (hero, тарифы, отзывы, CTA);
- **Сообщества** — блоки, опубликованные другими пользователями;
- **Пользовательские** — собственные сохраненные блоки/секции.

Возможности:

1. **Сохранение блока**:
   - выбрать один или несколько блоков;
   - через `SaveBlockModal` задать:
     - название,
     - описание,
     - категорию,
     - теги,
     - превью;
   - блок сохраняется как шаблон и доступен в Library.

2. **Использование шаблонов**:
   - на вкладке **Library** виден список шаблонов (карточки с названием и описанием);
   - блоки перетаскиваются в лендинг так же, как обычные;
   - составной блок включает внутри сразу несколько подготовленных элементов.

3. **Фильтрация и поиск**:
   - библиотека поддерживает категории и теги;
   - есть фильтры по типам (системные/сообщества/пользовательские).

---

### 7. Функции, события и логика

Конструктор поддерживает визуальную логику через систему триггеров и функций.

1. **Триггеры (события блоков)**:

```ts
type TriggerType =
  | 'onClick'
  | 'onHover'
  | 'onLoad'
  | 'onScroll'
  | 'onFocus'
  | 'onBlur'
  | 'onChange'
  | 'onSubmit';
```

Для каждого блока можно указать, какие функции должны выполняться при том или ином событии.

2. **Функции**:

Функция описывается примерно так:

- `id`, `name`, `description`;
- `trigger` — тип события;
- `blockId` — к какому блоку привязана (или глобальная);
- `conditions` — список условий;
- `actions` — массив действий;
- `type` — `visual` или `code` (возможность реализовать логику кодом);
- `enabled` — включена/выключена функция.

Типы действий (ActionType), которые можно комбинировать:

- `changeTheme` — смена темы/палитры;
- `redirect` — переход по ссылке/URL;
- `popup` — показ всплывающих окон;
- `scrollTo` — прокрутка к нужному блоку;
- `toggle` / `show` / `hide` — управление видимостью блоков;
- `animate` — анимации;
- `setValue` — выставление значений (например, в InputBlock);
- `log` / `custom` — отладка и кастомная логика.

3. **Привязка логики**:

- функции создаются и редактируются во вкладке **Logic**;
- в правой панели (`PropertiesPanel`) для каждого блока есть секция «События», где к конкретному триггеру (`onClick`, `onHover` и т.п.) привязываются нужные функции;
- при срабатывании события конструктор выполняет связанные функции в заданном порядке.

Это позволяет, не уходя в код, собирать достаточно сложную интерактивность.

---

### 8. AI-генерация лендингов

Отдельная страница **GeneratePage** подключена к ML-сервису.

1. **Форма генерации**:
   - поле ввода текста (описание лендинга: тематика, целевая аудитория, оффер, структура);
   - выбор категорий блоков (hero, features, pricing, testimonials, CTA и т.п.);
   - подсказки по формулировке запросов.

2. **Запрос к ML-сервису**:
   - фронтенд отправляет запрос на `/api/v1/generate` ML-сервиса;
   - сервис через Ollama/LLM формирует:
     - массив блоков (`blocks`),
     - палитру (`palette`),
     - мета-информацию (например, название проекта).

3. **Предпросмотр**:
   - компонент `GeneratePreview` показывает, какие секции будут добавлены;
   - отдельный лоадер (`GenerateLoading`) визуально отображает процесс генерации.

4. **Применение к проекту**:
   - по кнопке «Применить»:
     - палитра применится к теме проекта (`applyPaletteToProject`);
     - блоки будут добавлены в текущий лендинг (`addTemplateBlocks`).

Получается быстрый черновик, который потом вручную доводится в редакторе.

---

### 9. Управление проектами и медиа

1. **Список проектов** (`UserProjectsList`):
   - карточки с названием, датой последнего обновления;
   - кнопки «Редактировать» и «Удалить» (soft delete);
   - кнопка «Создать проект» — открывает модалку создания.

2. **Создание проекта** (`CreateProjectModal`):
   - ввод названия проекта;
   - выбор базового шаблона (при наличии).

3. **Медиа**:
   - загрузка изображений привязана к проекту;
   - бэкенд (`project_media`) отдает медиа по ETag;
   - изображения можно переиспользовать в разных блоках.

4. **Экспорт/импорт**:
   - в Toolbar есть действия:
     - экспорт текущего проекта в JSON;
     - импорт JSON (восстановление структуры лендинга).

---

### 10. Совместное редактирование (реальное время)

Конструктор изначально рассчитан на совместную работу команды.

- при открытии проекта фронтенд подключается к WebSocket бэкенда;
- через `usePresence` регулярно отправляются:
  - координаты курсора;
  - ID выделенного блока;
- `CursorsOverlay` отображает курсоры и имена/цвета участников;
- изменения, сделанные одним пользователем, транслируются всем подключенным;
- в рамках одного проекта работает общая «комната» редактирования.

 Спасибо что дочитали :)
